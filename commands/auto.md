---
description: 智能命令选择器，自动分发到合适的 aimax 命令。
---

# Auto 命令

根据用户输入自动选择最合适的命令执行。通过语义分析和关键词匹配，智能识别用户意图并路由到对应的专业命令。

## 核心理念

- **零配置**: 用户无需记忆具体命令，描述需求即可
- **智能匹配**: 基于优先级和语义权重进行最佳匹配
- **透明执行**: 清晰展示选择逻辑，便于用户理解和调整

## 选择规则

### 优先级说明

- **P0 (紧急)**: 阻塞性问题，必须立即处理
- **P1 (高)**: 质量保障相关，影响代码可靠性
- **P2 (中)**: 代码质量优化，提升可维护性
- **P3 (低)**: 辅助性任务，改善开发体验
- **P4 (默认)**: 通用开发任务，兜底选项

### 详细匹配规则

| 优先级 | 关键词 | 命令 | 适用场景 |
|--------|--------|------|----------|
| P0 | 构建失败、build fail、类型错误、type error、编译错误、compile error、tsc 报错、npm run build 失败 | `build-fix` | 项目无法编译、TypeScript 类型检查失败、构建流程中断 |
| P1 | e2e、端到端、playwright、cypress、浏览器测试、用户流程测试、自动化测试、UI 测试 | `e2e` | 编写或运行端到端测试、验证用户交互流程、跨页面功能测试 |
| P1 | 覆盖率、coverage、测试报告、未覆盖代码、覆盖率不足、istanbul、jest coverage | `test-coverage` | 生成测试覆盖率报告、识别未测试代码、提升测试覆盖 |
| P1 | tdd、测试驱动、单元测试、unit test、先写测试、vitest、jest、测试优先 | `tdd` | 采用 TDD 方法开发新功能、编写单元测试、修复 bug 时补充测试 |
| P2 | 审查、review、检查代码、code review、代码质量、安全检查、漏洞、最佳实践 | `code-review` | 提交前代码审查、安全漏洞扫描、代码质量评估、最佳实践检查 |
| P3 | 清理、重构、refactor、删除未使用、dead code、优化结构、整理代码、抽取公共、消除重复 | `refactor-clean` | 移除死代码、优化代码结构、提取公共逻辑、消除重复代码 |
| P3 | 文档、docs、README、注释、API 文档、使用说明、更新文档、写文档 | `update-docs` | 更新项目文档、编写 README、生成 API 文档、补充代码注释 |
| P3 | 代码地图、codemap、架构图、模块关系、依赖分析、项目结构 | `update-codemaps` | 生成代码架构图、分析模块依赖、可视化项目结构 |
| P4 | 实现、开发、功能、feature、新增、添加、创建、修改、implement、develop（默认兜底） | `plan` | 新功能开发、现有功能修改、任何未匹配的开发任务 |

### 冲突处理规则

当用户输入匹配多个命令时：

1. **优先级优先**: 选择优先级数字更小的命令
2. **精确优先**: 完全匹配优于部分匹配
3. **上下文优先**: 根据用户历史操作推断意图
4. **询问确认**: 多个同优先级命令时，询问用户确认

## 执行步骤

### 1. 分析意图
- 对用户输入进行分词和语义解析
- 提取核心关键词和动作词
- 识别技术术语和上下文线索

### 2. 匹配命令
- 按优先级从高到低遍历规则表
- 计算每条规则的匹配分数
- 选择得分最高且优先级最高的命令

### 3. 显示结果
- 清晰展示选中的命令
- 说明选择原因和匹配的关键词
- 提供备选命令供用户参考

### 4. 执行命令
- 调用对应命令的完整流程
- 传递用户原始输入作为参数
- 保持执行过程的透明可见

## 输出格式

```
📊 智能命令选择

🎯 **已选择**: `/aimax:[命令]`
📝 **原因**: [详细的选择原因说明]
🔍 **关键词**: [匹配的关键词列表]
💡 **备选**: [其他可能相关的命令]

---
⏳ 正在执行 `/aimax:[命令]` ...
```

## 使用示例

### 示例 1: 新功能开发

```
用户：/aimax:auto 添加用户登录功能

📊 智能命令选择

🎯 **已选择**: `/aimax:plan`
📝 **原因**: 检测到新功能开发需求，需先制定实现计划确保架构合理
🔍 **关键词**: "添加"、"功能"、"登录"
💡 **备选**: `/aimax:tdd`（如果希望采用测试驱动开发）

---
⏳ 正在执行 `/aimax:plan` ...
```

### 示例 2: 构建错误

```
用户：/aimax:auto npm run build 报错了，类型不匹配

📊 智能命令选择

🎯 **已选择**: `/aimax:build-fix`
📝 **原因**: 检测到构建失败和类型错误，这是 P0 级阻塞性问题，需立即修复
🔍 **关键词**: "build"、"报错"、"类型不匹配"
💡 **备选**: 无（构建问题应优先解决）

---
⏳ 正在执行 `/aimax:build-fix` ...
```

### 示例 3: 代码审查

```
用户：/aimax:auto 帮我检查一下这段代码有没有安全问题

📊 智能命令选择

🎯 **已选择**: `/aimax:code-review`
📝 **原因**: 用户明确要求代码检查和安全分析，适合使用代码审查命令
🔍 **关键词**: "检查"、"安全问题"
💡 **备选**: `/aimax:refactor-clean`（如果主要目的是代码优化）

---
⏳ 正在执行 `/aimax:code-review` ...
```

### 示例 4: 测试相关

```
用户：/aimax:auto 我想用 TDD 的方式实现购物车功能

📊 智能命令选择

🎯 **已选择**: `/aimax:tdd`
📝 **原因**: 用户明确指定使用 TDD 方法，将先编写测试再实现功能
🔍 **关键词**: "TDD"、"实现"
💡 **备选**: `/aimax:plan`（如果需要先做详细规划）

---
⏳ 正在执行 `/aimax:tdd` ...
```

### 示例 5: 文档更新

```
用户：/aimax:auto README 需要更新，加上新的 API 说明

📊 智能命令选择

🎯 **已选择**: `/aimax:update-docs`
📝 **原因**: 检测到文档更新需求，将协助完善项目文档
🔍 **关键词**: "README"、"更新"、"API 说明"
💡 **备选**: `/aimax:update-codemaps`（如果需要更新架构图）

---
⏳ 正在执行 `/aimax:update-docs` ...
```

## 边界情况处理

### 模糊输入
当用户输入过于模糊时（如 `/aimax:auto 帮帮我`），默认选择 `/aimax:plan` 并提示用户提供更多信息。

### 多意图输入
当用户输入包含多个意图时（如 `/aimax:auto 修复构建错误然后跑一下测试`），优先处理高优先级任务，完成后提示用户执行下一个任务。

### 否定表达
识别否定词（如"不要"、"不用"），避免选择被否定的命令。

## 相关命令

| 命令 | 用途 |
|------|------|
| `/aimax:plan` | 功能规划与实现方案设计 |
| `/aimax:tdd` | 测试驱动开发工作流 |
| `/aimax:code-review` | 代码质量与安全审查 |
| `/aimax:build-fix` | 构建错误与类型问题修复 |
| `/aimax:e2e` | 端到端测试生成与执行 |
| `/aimax:test-coverage` | 测试覆盖率分析与提升 |
| `/aimax:refactor-clean` | 代码重构与死代码清理 |
| `/aimax:update-docs` | 文档更新与维护 |
| `/aimax:update-codemaps` | 代码架构图更新 |
